{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "LLM Provider Config",
  "type": "object",
  "properties": {
    "schema_name": { "const": "LLMProviderConfig" },
    "schema_version": { "const": "1.0.0" },
    "provider": { "enum": ["stub", "litellm"] },
    "mode": { "enum": ["deterministic_stub", "litellm_live"] },
    "timeout_ms": {
      "type": "integer",
      "minimum": 1000,
      "maximum": 60000
    },
    "max_output_chars": {
      "type": "integer",
      "minimum": 1,
      "maximum": 500
    },
    "stub": {
      "type": "object",
      "properties": {
        "fixtures_path": { "type": "string" },
        "default_response": { "type": "string" },
        "key_strategy": { "enum": ["persona_marker", "marker_only"] }
      },
      "required": ["fixtures_path", "default_response", "key_strategy"],
      "additionalProperties": false
    },
    "litellm": {
      "type": "object",
      "properties": {
        "model": { "type": "string" },
        "api_base": { "type": "string" },
        "api_key_env": { "type": "string" },
        "temperature": { "type": "number", "minimum": 0, "maximum": 2 },
        "max_tokens": { "type": "integer", "minimum": 1, "maximum": 512 },
        "timeout_s": { "type": "number", "minimum": 1, "maximum": 120 },
        "num_retries": { "type": "integer", "minimum": 0, "maximum": 5 },
        "extra": { "type": "object" }
      },
      "required": ["model"],
      "additionalProperties": false
    },
    "metadata": { "type": "object" }
  },
  "required": [
    "schema_name",
    "schema_version",
    "provider",
    "mode",
    "timeout_ms",
    "max_output_chars"
  ],
  "allOf": [
    {
      "if": { "properties": { "provider": { "const": "stub" } } },
      "then": { "required": ["stub"] }
    },
    {
      "if": { "properties": { "provider": { "const": "litellm" } } },
      "then": { "required": ["litellm"] }
    }
  ],
  "additionalProperties": false
}
